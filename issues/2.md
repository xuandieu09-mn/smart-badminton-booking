# Day 6 Authentication Module with JWT and bcrypt Guide

## Overview
In this guide, we will set up an authentication module in our application using JWT (JSON Web Token) for secure communication and bcrypt to hash user passwords.

## 1. Data Transfer Object (DTOs)
We will create DTOs for registering and logging in users.

### User Registration DTO
```typescript
export class RegisterUserDto {
    readonly username: string;
    readonly password: string;
}
```

### User Login DTO
```typescript
export class LoginUserDto {
    readonly username: string;
    readonly password: string;
}
```

## 2. Auth Service
The Auth Service will handle the logic for user registration and login.

### Auth Service Implementation
```typescript
import { Injectable } from '@nestjs/common';
import { JwtService } from '@nestjs/jwt';
import { bcrypt } from 'bcrypt';
import { RegisterUserDto, LoginUserDto } from './dto';
import { User } from './entities/user.entity'; // Example user entity

@Injectable()
export class AuthService {
    constructor(private jwtService: JwtService) {}

    async register(dto: RegisterUserDto) {
        const hashedPassword = await bcrypt.hash(dto.password, 10);
        // Save user to the database with hashedPassword
    }

    async login(dto: LoginUserDto) {
        // Validate user credentials and return JWT
        const user: User = await this.findUser(dto.username);
        const isPasswordValid = await bcrypt.compare(dto.password, user.password);
        if (!isPasswordValid) throw new Error('Invalid credentials');

        return this.jwtService.sign({ username: user.username });
    }
}
```

## 3. JWT Strategy
Setting up the JWT strategy for authentication.

### JwtStrategy Implementation
```typescript
import { Injectable } from '@nestjs/common';
import { PassportStrategy } from '@nestjs/passport';
import { Strategy, ExtractJwt } from 'passport-jwt';
import { AuthService } from './auth.service';

@Injectable()
export class JwtStrategy extends PassportStrategy(Strategy) {
    constructor(private authService: AuthService) {
        super({
            jwtFromRequest: ExtractJwt.fromAuthHeaderAsBearerToken(),
            secretOrKey: 'your_jwt_secret',
        });
    }

    async validate(payload: any) {
        return { username: payload.username }; // Return the user object
    }
}
```

## 4. Auth Controller
The controller that exposes registration and login routes.

### AuthController Implementation
```typescript
import { Controller, Post, Body } from '@nestjs/common';
import { AuthService } from './auth.service';
import { RegisterUserDto, LoginUserDto } from './dto';

@Controller('auth')
export class AuthController {
    constructor(private authService: AuthService) {}

    @Post('register')
    async register(@Body() dto: RegisterUserDto) {
        return this.authService.register(dto);
    }

    @Post('login')
    async login(@Body() dto: LoginUserDto) {
        return this.authService.login(dto);
    }
}
```

## 5. Test Examples
To test the registration and login functionality, you can use Postman or any HTTP client.

### Test Registration
- **POST** `/auth/register`
- **Body:**
```json
{
    "username": "testuser",
    "password": "testpassword"
}
```

### Test Login
- **POST** `/auth/login`
- **Body:**
```json
{
    "username": "testuser",
    "password": "testpassword"
}
```

## Conclusion
This guide covered the authentication mechanism using JWT and bcrypt in a NestJS application. Ensure to handle errors and add proper validation for production-ready code.