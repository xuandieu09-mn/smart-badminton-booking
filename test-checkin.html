<!DOCTYPE html>
<html>
<head>
    <title>Test Check-in API</title>
    <style>
        body { font-family: Arial; max-width: 800px; margin: 50px auto; padding: 20px; }
        .result { margin-top: 20px; padding: 15px; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        pre { background: #f5f5f5; padding: 10px; overflow: auto; }
    </style>
</head>
<body>
    <h1>üîç Test Check-in API</h1>
    
    <div>
        <label>Token t·ª´ localStorage: </label>
        <input type="text" id="tokenDisplay" readonly style="width: 500px; padding: 5px;">
        <button onclick="loadToken()">üîÑ Load Token</button>
    </div>
    
    <div style="margin-top: 20px;">
        <label>Booking Code: </label>
        <input type="text" id="bookingCode" value="TEST04" style="padding: 5px;">
        <button onclick="testCheckIn()">‚úÖ Test Check-in</button>
        <button onclick="testGetBookings()">üìã Get Bookings</button>
    </div>
    
    <div id="result"></div>
    
    <script>
        function loadToken() {
            const token = localStorage.getItem('access_token');
            document.getElementById('tokenDisplay').value = token || 'NO TOKEN FOUND';
            return token;
        }
        
        async function testCheckIn() {
            const token = loadToken();
            if (!token) {
                showResult('‚ùå No token found. Please login first!', 'error');
                return;
            }
            
            const bookingCode = document.getElementById('bookingCode').value;
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '‚è≥ Testing...';
            
            try {
                const response = await fetch('http://localhost:3000/api/bookings/check-in', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ bookingCode })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showResult(`‚úÖ Success!\n${JSON.stringify(data, null, 2)}`, 'success');
                } else {
                    showResult(`‚ùå Error ${response.status}:\n${JSON.stringify(data, null, 2)}`, 'error');
                }
            } catch (error) {
                showResult(`‚ùå Network Error:\n${error.message}`, 'error');
            }
        }
        
        async function testGetBookings() {
            const token = loadToken();
            if (!token) {
                showResult('‚ùå No token found. Please login first!', 'error');
                return;
            }
            
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '‚è≥ Loading bookings...';
            
            try {
                const response = await fetch('http://localhost:3000/api/bookings', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    const confirmed = data.bookings.filter(b => b.status === 'CONFIRMED');
                    showResult(`‚úÖ Found ${confirmed.length} CONFIRMED bookings:\n${JSON.stringify(confirmed, null, 2)}`, 'success');
                } else {
                    showResult(`‚ùå Error ${response.status}:\n${JSON.stringify(data, null, 2)}`, 'error');
                }
            } catch (error) {
                showResult(`‚ùå Network Error:\n${error.message}`, 'error');
            }
        }
        
        function showResult(message, type) {
            const resultDiv = document.getElementById('result');
            resultDiv.className = `result ${type}`;
            resultDiv.innerHTML = `<pre>${message}</pre>`;
        }
        
        // Auto-load token on page load
        window.onload = loadToken;
    </script>
</body>
</html>
