# ğŸ¯ POS INVOICE - QUICK REFERENCE CARD

## ğŸ“± UI Flow (What Staff Sees)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ›’ POS - BÃN HÃ€NG Táº I SÃ‚N                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  LEFT: Product Grid          â”‚  RIGHT: Cart         â”‚
â”‚  â”œâ”€ ğŸ¸ á»ng cáº§u               â”‚  â”œâ”€ Sáº£n pháº©m 1: 2x   â”‚
â”‚  â”œâ”€ ğŸ¥¤ NÆ°á»›c uá»‘ng             â”‚  â”œâ”€ Sáº£n pháº©m 2: 1x   â”‚
â”‚  â”œâ”€ ğŸ¾ Phá»¥ kiá»‡n              â”‚  â”œâ”€ Sáº£n pháº©m 3: 3x   â”‚
â”‚  â”œâ”€ âš¡ Dá»¥ng cá»¥               â”‚  â”œâ”€ Tá»•ng: 280,000Ä‘   â”‚
â”‚  â””â”€ ğŸ“¦ KhÃ¡c                  â”‚  â”œâ”€ TÃªn KH: [input]  â”‚
â”‚                              â”‚  â”œâ”€ Thanh toÃ¡n:      â”‚
â”‚                              â”‚  â”‚  ğŸ’µ Tiá»n máº·t      â”‚
â”‚                              â”‚  â”‚  ğŸ’³ Chuyá»ƒn khoáº£n  â”‚
â”‚                              â”‚  â””â”€ [ğŸ“„ Táº¡o hÃ³a Ä‘Æ¡n] â”‚
â”‚                              â”‚     (was âœ… Thanh toÃ¡n)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                            â–¼ Click "ğŸ“„ Táº¡o hÃ³a Ä‘Æ¡n"

        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ ğŸ“„ BIÃŠN LAI BÃN HÃ€NG                  â”‚
        â”‚ MÃ£ HÄ: INV-1703419200000-5            â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚ KhÃ¡ch: Nguyá»…n VÄƒn A | NhÃ¢n viÃªn: Tráº§n â”‚
        â”‚ Thá»i gian: 24/12/2025 14:30:00         â”‚
        â”‚ Thanh toÃ¡n: ğŸ’µ Tiá»n máº·t                â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚ Sáº¢N PHáº¨M      â”‚SLâ”‚  GIÃ   â”‚   Tá»”NG    â”‚
        â”‚ NÆ°á»›c cam       â”‚2 â”‚ 20k   â”‚  40k     â”‚
        â”‚ Vá»£t cáº§u lÃ´ng  â”‚1 â”‚150k   â”‚ 150k     â”‚
        â”‚ á»ng cáº§u       â”‚3 â”‚ 30k   â”‚  90k     â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚ ğŸ’° Tá»”NG Cá»˜NG:        280,000Ä‘        â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
        â”‚ BIÃŠN LAI BÃN HÃ€NG (receipt preview)   â”‚
        â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
        â”‚ [monospace receipt text...]           â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚ [ğŸ–¨ï¸ In]  [âœ… XÃ¡c nháº­n]  [âŒ Huá»·]      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

        User can:
        â”œâ”€ ğŸ–¨ï¸ Click "In hÃ³a Ä‘Æ¡n" â†’ Print dialog
        â”œâ”€ âœ… Click "XÃ¡c nháº­n" â†’ Sale created
        â””â”€ âŒ Click "Huá»·" â†’ Modal closes
```

---

## ğŸ”„ Technical Flow (What Happens Behind)

```
FRONTEND                              BACKEND
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
User adds products to cart
                                      
User enters customer name             

User clicks "ğŸ“„ Táº¡o hÃ³a Ä‘Æ¡n"
        â”‚
        â”œâ”€ Validate cart (not empty)
        â”œâ”€ Validate customerName (not empty)
        â”‚
        â””â”€ POST /pos/sales/generate-invoice
                                      â”‚
                                      â–¼
                                InvoiceService:
                                â”œâ”€ Find each product
                                â”œâ”€ Check stock
                                â”œâ”€ Calculate totals
                                â”œâ”€ Format receipt
                                â”‚
                                â–¼
                                Return 200 OK
                                {
                                  invoice: {...},
                                  printFormat: "..."
                                }
        â”‚
        â–¼
Show invoice modal

User clicks "ğŸ–¨ï¸ In hÃ³a Ä‘Æ¡n"
        â””â”€ window.open() with printFormat
           â””â”€ User selects printer
              â””â”€ Prints receipt

User clicks "âœ… XÃ¡c nháº­n thanh toÃ¡n"
        â””â”€ POST /pos/sales
                                      â”‚
                                      â–¼
                                SalesService.createSale():
                                â”œâ”€ Create Sale record
                                â”œâ”€ Create SaleItem records
                                â”œâ”€ Decrement stock
                                â”œâ”€ Create InventoryAction logs
                                â”‚
                                â–¼
                                Return 200 OK
                                {sale: {...}}
        â”‚
        â–¼
Close modal
Clear cart
Reset form
Refresh products
```

---

## ğŸ“Š Response Examples

### Generate Invoice Response
```json
{
  "message": "Invoice generated successfully",
  "invoice": {
    "invoiceCode": "INV-1703419200000-5",
    "customerName": "Nguyá»…n VÄƒn A",
    "paymentMethod": "CASH",
    "staffName": "Tráº§n B",
    "createdAt": "24/12/2025 14:30:00",
    "items": [
      {"productId": 1, "productName": "NÆ°á»›c cam", "price": 20000, "quantity": 2, "subtotal": 40000},
      {"productId": 2, "productName": "Vá»£t", "price": 150000, "quantity": 1, "subtotal": 150000}
    ],
    "totalAmount": 190000
  },
  "printFormat": "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n..."
}
```

### Create Sale Response
```json
{
  "message": "Sale created successfully",
  "sale": {
    "id": 1001,
    "saleCode": "SALE-1001",
    "totalAmount": 190000,
    "paymentMethod": "CASH",
    "customerName": "Nguyá»…n VÄƒn A",
    "staffId": 5,
    "items": [...]
  }
}
```

---

## âš¡ Quick Commands

```bash
# Test invoice generation
curl -X POST http://localhost:3000/api/pos/sales/generate-invoice \
  -H "Authorization: Bearer TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "items": [{"productId": 1, "quantity": 2}],
    "customerName": "Test",
    "paymentMethod": "CASH"
  }'

# Test payment confirmation
curl -X POST http://localhost:3000/api/pos/sales \
  -H "Authorization: Bearer TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "items": [{"productId": 1, "quantity": 2}],
    "customerName": "Test",
    "paymentMethod": "CASH"
  }'
```

---

## ğŸ¯ Key States

| Component | State | Value | Effect |
|-----------|-------|-------|--------|
| showInvoiceModal | false | Button shows "ğŸ“„ Táº¡o hÃ³a Ä‘Æ¡n" |
| showInvoiceModal | true | Modal appears | Can't interact with cart |
| isGeneratingInvoice | true | Button disabled | "â³ Äang táº¡o hÃ³a Ä‘Æ¡n..." |
| isGeneratingInvoice | false | Button active | Ready to generate |
| loading | true | Payment btn disabled | "â³ Äang xá»­ lÃ½..." |
| loading | false | Payment btn active | Ready to confirm |
| invoice | null | Modal hidden | |
| invoice | {...} | Modal shown | Shows invoice details |

---

## âœ… Validation Rules

```
Before generating invoice:
âœ“ cart.length > 0 ("Giá» hÃ ng trá»‘ng")
âœ“ customerName.trim().length > 0 ("Vui lÃ²ng nháº­p tÃªn khÃ¡ch")

In backend:
âœ“ Each product exists ("Product not found")
âœ“ Each product isActive ("Product not available")
âœ“ stock >= quantity ("Insufficient stock")

After validation:
âœ“ Generate unique invoiceCode (INV-{timestamp}-{staffId})
âœ“ Calculate totalAmount
âœ“ Format receipt text
âœ“ Return invoice + printFormat
```

---

## ğŸš¨ Common Errors

| Error | Cause | Solution |
|-------|-------|----------|
| "Giá» hÃ ng trá»‘ng" | No products in cart | Add products |
| "Vui lÃ²ng nháº­p tÃªn khÃ¡ch hÃ ng" | Customer name empty | Enter customer name |
| "KhÃ´ng Ä‘á»§ hÃ ng! Tá»“n kho: X" | Not enough stock | Reduce quantity |
| "Sáº£n pháº©m khÃ´ng tá»“n táº¡i" | Product not found | Contact admin |
| "Lá»—i táº¡o hÃ³a Ä‘Æ¡n: ..." | Backend error | Check server logs |
| "Lá»—i thanh toÃ¡n: ..." | Payment failed | Retry payment |

---

## ğŸ“‹ Files to Know

| File | Purpose |
|------|---------|
| `src/modules/pos/invoice.service.ts` | Generate & format invoices |
| `src/modules/pos/dto/invoice.dto.ts` | Validate invoice requests |
| `src/modules/pos/sales.controller.ts` | Handle /generate-invoice endpoint |
| `frontend/src/features/staff/pages/StaffPosPage.tsx` | POS UI & logic |

---

## ğŸ“ Learn More

ğŸ“– Full docs in:
- `docs/POS-INVOICE-FEATURE.md`
- `docs/POS-INVOICE-USAGE-GUIDE.md`
- `docs/POS-INVOICE-FLOW-DIAGRAM.md`
- `docs/POS-INVOICE-CODE-EXAMPLES.md`

---

**Version:** 1.0
**Date:** December 24, 2025
**Status:** âœ… Ready
